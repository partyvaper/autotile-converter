<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>partyvaper's autotile converter</title>
    <style>
      body,html{box-sizing:border-box;margin:0;padding:0}body{display:flex;flex-direction:column;align-items:center;justify-content:start;gap:1em;padding:1em;font:1em/1.5 sans-serif}.drop-area{border:2px dashed silver;padding:2em;margin-top:1em;text-align:center}.drag-over{border-color:#000}#expected,canvas{border:1px solid gray;image-rendering:pixelated;image-rendering:crisp-edges;image-rendering:optimizeSpeed;image-rendering:-moz-crisp-edges;image-rendering:-webkit-optimize-contrast;image-rendering:-o-crisp-edges;image-rendering:pixelated;-ms-interpolation-mode:nearest-neighbor}canvas{background:url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAQAAAAEAQMAAACTPww9AAAABlBMVEX///+AgIBizNOVAAAADklEQVQI12MwAMIDDAcABUgB4VoeRSkAAAAASUVORK5CYII=') center center/8px 8px #fff}.number-input{width:4em}:checked+span{font-weight:700}#tileMode1+span{border-bottom:2px solid #50f}#tileMode2+span{border-bottom:2px solid #00feff}#tileMode3+span{border-bottom:2px solid #54ff00}#tileMode4+span{border-bottom:2px solid #ffd400} 
    </style>
  </head>
  <body>
    <div class=drop-area id=dropArea><h4><span>partyvaper's RPG Maker to Godot autotile converter</span> <a href=https://github.com/partyvaper/autotile-converter target=_blank>GitHub</a></h4><p>Drag & drop here or choose file or load from url:</p><input id=imageInput type=file class=file-input accept=image/*> <input id=imageUrlInput value=https://i.imgur.com/x7qYOM0.png placeholder="Enter image URL"value-template=https://i.imgur.com/7DVNEHS.png value-firsthalf=https://i.imgur.com/9YMnzZW.png value-secondhalf=https://i.imgur.com/pb6J73v.png> <button id=loadUrlButton>Load from URL</button></div><div><span>Tile size px:</span> <input id=tileSizeInput type=number value=32 class=number-input max=512 min=2 step=2></div><div><span>Tile mode:</span> <label title="RPG Maker Autotile 2X3 (Usually water, ground)"><input id=tileMode1 type=radio value=1 name=tileMode checked> <span>RPGM AT 2X3</span></label> <label title="RPG Maker Autotile 2X2 (Usually roofs and walls)"><input id=tileMode2 type=radio value=2 name=tileMode> <span>RPGM AT 2X2</span></label> <label title="Copy tiles 1:1 2X2 (Useful for random tiles in-between)"><input id=tileMode3 type=radio value=3 name=tileMode> <span>COPY 2X2</span></label> <label title="Copy tile 1:1 1X1 (Useful for random tiles in-between)"><input id=tileMode4 type=radio value=4 name=tileMode> <span>COPY 1X1</span></label></div><div>Input: <button id=clearButton type=button>Clear selection</button></div><canvas id=canvas></canvas><div>Output:</div><canvas id=gdCanvas></canvas><button id=saveButton>Save</button>
    <script type="text/javascript">
      !function(e){var _;let t=[{src:[1,0,.5,.5],dest:[[4,2],[6,2],[4,4],[6,4],[8,6],[10,2],[10,6],[14,0],[14,2],[14,6],[16,4],[18,0],[18,2],]},{src:[1.5,0,.5,.5],dest:[[3,2],[5,2],[3,4],[5,4],[9,0],[9,2],[9,6],[13,2],[13,6],[15,6],[19,0],[21,4],[23,2],]},{src:[1,.5,.5,.5],dest:[[4,1],[4,3],[6,1],[6,3],[8,1],[10,1],[10,5],[14,1],[14,5],[14,7],[16,5],[20,5],[20,7],]},{src:[1.5,.5,.5,.5],dest:[[3,1],[3,3],[5,1],[5,3],[9,1],[9,5],[9,7],[13,1],[13,5],[15,1],[19,3],[21,7],[23,3],]},{src:[0,1,.5,.5],dest:[[0,0],[2,0],[0,6],[2,6],[16,0]]},{src:[.5,1,.5,.5],dest:[[3,0],[3,6],[5,0],[5,6],[11,0],[13,0],[17,0],[21,0],]},{src:[1,1,.5,.5],dest:[[4,0],[4,6],[6,0],[6,6],[10,0],[12,0],[20,0],[22,0],]},{src:[1.5,1,.5,.5],dest:[[1,0],[1,6],[7,0],[7,6],[23,0],]},{src:[0,1.5,.5,.5],dest:[[0,1],[0,3],[2,1],[2,3],[8,3],[8,5],[16,1],[16,3],]},{src:[.5,1.5,.5,.5],dest:[[9,3],[11,1],[11,3],[11,5],[13,3],[15,7],[17,1],[17,3],[17,5],[19,1],[19,5],[21,1],[21,5],]},{src:[1,1.5,.5,.5],dest:[[8,7],[10,3],[12,1],[12,3],[12,5],[14,3],[18,1],[18,3],[18,5],[20,1],[22,1],[22,3],[22,5],]},{src:[1.5,1.5,.5,.5],dest:[[1,1],[1,3],[7,1],[7,3],[15,3],[15,5],[23,1],[23,5],]},{src:[0,2,.5,.5],dest:[[0,2],[0,4],[2,2],[2,4],[8,2],[8,4],[16,2],[16,6],]},{src:[.5,2,.5,.5],dest:[[9,4],[11,2],[11,4],[11,6],[13,4],[15,0],[17,2],[17,4],[17,6],[19,2],[19,4],[19,6],[21,6],]},{src:[1,2,.5,.5],dest:[[8,0],[10,4],[12,2],[12,4],[12,6],[14,4],[18,4],[18,6],[20,4],[20,6],[22,2],[22,4],[22,6],]},{src:[1.5,2,.5,.5],dest:[[1,2],[1,4],[7,2],[7,4],[15,2],[15,4],[23,4],[23,6],]},{src:[0,2.5,.5,.5],dest:[[0,5],[0,7],[2,5],[2,7],[16,7],]},{src:[.5,2.5,.5,.5],dest:[[3,5],[3,7],[5,5],[5,7],[11,7],[13,7],[17,7],[19,7],]},{src:[1,2.5,.5,.5],dest:[[4,5],[4,7],[6,5],[6,7],[10,7],[12,7],[18,7],[22,7],]},{src:[1.5,2.5,.5,.5],dest:[[1,5],[1,7],[7,5],[7,7],[23,7],]}],$=[{src:[0,0,1,1],dest:[[0,0],]},{src:[.5,0,1,1],dest:[[1,0],]},{src:[1,0,1,1],dest:[[2,0],]},{src:[0,.5,1,1],dest:[[0,1],]},{src:[.5,.5,1,1],dest:[[1,1],]},{src:[1,.5,1,1],dest:[[2,1],]},{src:[0,1,1,1],dest:[[0,2],]},{src:[.5,1,1,1],dest:[[1,2],]},{src:[1,1,1,1],dest:[[2,2],]},],n=[{src:[0,0,1,1],dest:[[0,0],]}],s=[{src:[0,0,1,1],dest:[[0,0],]},{src:[1,0,1,1],dest:[[1,0],]},{src:[0,1,1,1],dest:[[0,1],]},{src:[1,1,1,1],dest:[[1,1],]}],r=[0,0],d=null,i=[],l=32,c="output.png",o=1,a=e.getElementById("canvas"),u=e.getElementById("gdCanvas"),f=a.getContext("2d"),g=u.getContext("2d"),h=e.getElementById("dropArea");e.getElementById("debugText");let m=e.getElementById("imageInput"),v=e.getElementById("imageUrlInput"),E=e.getElementById("loadUrlButton"),p=e.getElementById("tileSizeInput"),y=e.getElementById("saveButton"),I=e.getElementsByName("tileMode"),L=e.getElementById("clearButton");function B(e){o=Number(e.target.value)}function w(e){return 1===e?260:2===e?180:3===e?100:50}function x(e){return 1===e?t:2===e?$:3===e?s:n}function k(e,_){let t=Math.max(l,e),$=Math.max(l,_);u.width=t,u.height=$,u.style.width=`${t}px`,u.style.height=`${$}px`}function S(e){e.preventDefault(),"dragover"===e.type?h.classList.add("drag-over"):h.classList.remove("drag-over")}function b(){let e=v.value.trim();if(e){let _=new Image;_.crossOrigin="anonymous",_.onload=function(){a.width=1*_.width,a.height=1*_.height,d=_,c="output.png"},_.src=e}}function R(e){if(e){let _=new FileReader;_.onload=function(_){let t=new Image;t.crossOrigin="anonymous",t.onload=function(){a.width=1*t.width,a.height=1*t.height,d=t,c=e.name.substr(0,e.name.length-4)+"_Godot.png"},t.src=_.target.result},_.readAsDataURL(e)}}function C(e){return[D(e[0]),D(e[1]),]}function D(e){return Math.floor((e+l/2)/l)*l}function O(e,_,t){var $;let[n,s]=1===($=t)?[2,3]:2===$||3===$?[2,2]:[1,1],r=l*n,d=l*s,i=D(e-r/2),c=D(_-d/2);return[i,c,r,d]}function U(e,_,t,$,n){let s=O(e,_,t);f.beginPath(),f.rect(s[0],s[1],s[2],s[3]),f.fillStyle=`hsla(${$}, 100%, 70%, ${n})`,f.strokeStyle=`hsla(${$}, 100%, 40%, 1.0)`,f.lineWidth=1,f.fill(),f.stroke(),f.closePath()}function A(e,_,t=!0){let $=i.reduce(($,n)=>{var s;let r=O(...n),[d,i]=1===(s=n[2])?[12,4]:2===s?[3,3]:3===s?[2,2]:[1,1],l=r[0]<e,c=r[1]<_,o=r[1]>=_+i,a=r[0]>=e+d;if(!t||l&&!o){let u=$[0].indexOf(r[0]);u>-1&&d>$[1][u]&&($[2]-=$[1][u],$[1][u]=d,$[2]+=d),u<0&&($[0].push(r[0]),$[1].push(d),$[2]+=d)}if(!t||c&&!a&&!l){let f=$[3].indexOf(r[1]);f>-1&&i>$[4][f]&&($[5]-=$[4][f],$[4][f]=i,$[5]+=i),f<0&&($[3].push(r[1]),$[4].push(i),$[5]+=i)}return $},[[],[],0,[],[],0]),n=$[2]*l,s=$[5]*l;return[n,s]}function P(){for(let e of(f.clearRect(0,0,a.width,a.height),d&&f.drawImage(d,0,0),i))U(e[0],e[1],e[2],w(e[2]),.5);U(r[0],r[1],o,0,.2),g.clearRect(0,0,u.width,u.height);let[_,t,$]=function e(_){let t=0,$=0,n=[];for(let s of _){let[r,d]=O(s[0],s[1],s[2]),[i,c]=A(r,d,!0),o=x(s[2]);for(let a of o){let u=a.src,f=r+u[0]*l,g=d+u[1]*l,h=u[2]*l,m=u[3]*l;for(let v of a.dest){let E=i+v[0]*h,p=c+v[1]*m;t=Math.max(t,E+h),$=Math.max($,p+m),n.push([f,g,h,m,E,p,h,m])}}}return[n,t,$]}(i);for(let n of(k(t,$),_))g.drawImage(d,...n);requestAnimationFrame(P)}h.addEventListener("dragover",S),h.addEventListener("dragleave",S),h.addEventListener("drop",function e(_){_.preventDefault(),h.classList.remove("drag-over");let t=_.dataTransfer.files[0];R(t)}),m.addEventListener("change",function e(_){let t=_.target.files[0];R(t)}),E.addEventListener("click",b),a.addEventListener("mousemove",function e(_){let t=a.getBoundingClientRect();r[0]=_.clientX-t.left,r[1]=_.clientY-t.top}),a.addEventListener("click",function e(_){let t=i.findIndex(e=>{let _=O(e[0],e[1],e[2]),t=O(r[0],r[1],o);return _.toString()===t.toString()});t>-1?i.splice(t,1):i.push([...r,o]);let[$,n]=A(1/0,1/0,!1);k($,n)}),p.addEventListener("change",function e(_){l=Number(_.target.value)}),y.addEventListener("click",function _(){var t=e.createElement("a");t.download=c,t.href=u.toDataURL(),t.click()}),I.forEach(function(e){e.addEventListener("change",B)}),L.addEventListener("click",function e(_){i.length=0,k(l,l)}),a.imageSmoothingEnabled=!1,u.imageSmoothingEnabled=!1,k(l,l),b();let T,z=(_=P,function(){let e=this,t=arguments,$=function(){T=null,_.apply(e,t)};clearTimeout(T),T=setTimeout($,1e3)});z()}(document); 
    </script>
  </body>
</html>
