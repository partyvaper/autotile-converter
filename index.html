<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>partyvaper's autotile converter</title>
    <style>
      body,html{box-sizing:border-box;margin:0;padding:0}body{display:flex;flex-direction:column;align-items:center;justify-content:start;gap:1em;padding:1em;font:1em/1.5 sans-serif}.drop-area{border:2px dashed silver;padding:2em;margin-top:1em;text-align:center}.drag-over{border-color:#000}#expected,canvas{border:1px solid gray;image-rendering:pixelated;image-rendering:crisp-edges;image-rendering:optimizeSpeed;image-rendering:-moz-crisp-edges;image-rendering:-webkit-optimize-contrast;image-rendering:-o-crisp-edges;image-rendering:pixelated;-ms-interpolation-mode:nearest-neighbor}canvas{background:url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAQAAAAEAQMAAACTPww9AAAABlBMVEX///+AgIBizNOVAAAADklEQVQI12MwAMIDDAcABUgB4VoeRSkAAAAASUVORK5CYII=') center center/8px 8px #fff}.number-input{width:4em}
    </style>
  </head>
  <body>
    <div class=drop-area id=dropArea><h4><span>partyvaper's RPG Maker to Godot autotile converter</span> <a href=https://github.com/partyvaper/autotile-converter target=_blank>GitHub</a></h4><p>Drag & drop here or choose file or load from url:</p><input id=imageInput class=file-input type=file accept=image/*> <input id=imageUrlInput value=https://i.imgur.com/x7qYOM0.png placeholder="Enter image URL"value-firsthalf=https://i.imgur.com/9YMnzZW.png value-secondhalf=https://i.imgur.com/pb6J73v.png value-template=https://i.imgur.com/7DVNEHS.png> <button id=loadUrlButton>Load from URL</button></div><div><span>Tile size px:</span> <input id=tileSizeInput class=number-input type=number value=32></div><div>Input:</div><canvas id=canvas></canvas><div>Output:</div><canvas id=gdCanvas></canvas><button id=saveButton>Save</button>
  	<script type="text/javascript">
      !function(e){var t;let _=[0,0],n=null,$=[],r=32,l=r/2,s="output.png",d=e.getElementById("canvas"),i=e.getElementById("gdCanvas"),o=d.getContext("2d"),a=i.getContext("2d"),c=e.getElementById("dropArea");e.getElementById("debugText");let u=e.getElementById("imageInput"),g=e.getElementById("imageUrlInput"),f=e.getElementById("loadUrlButton"),h=e.getElementById("tileSizeInput"),m=e.getElementById("saveButton");function v(e,t){let _=Math.max(r,e),n=Math.max(r,t);i.width=_,i.height=n,i.style.width=`${_}px`,i.style.height=`${n}px`}function E(e){e.preventDefault(),"dragover"===e.type?c.classList.add("drag-over"):c.classList.remove("drag-over")}function p(){let e=g.value.trim();if(e){let t=new Image;t.crossOrigin="anonymous",t.onload=function(){d.width=1*t.width,d.height=1*t.height,n=t,s="output.png"},t.src=e}}function y(e){if(console.log(e),e){let t=new FileReader;t.onload=function(t){let _=new Image;_.crossOrigin="anonymous",_.onload=function(){d.width=1*_.width,d.height=1*_.height,n=_,s=e.name.substr(0,e.name.length-4)+"_Godot.png"},_.src=t.target.result},t.readAsDataURL(e)}}function I(e){return[w(e[0]),w(e[1]),]}function w(e){return Math.floor((e+r/2)/r)*r}function L(e,t){let _=2*r,n=3*r,$=w(e-_/2),l=w(t-n/2);return[$,l,_,n]}function B(e,t,_,n){let $=L(e,t);o.beginPath(),o.rect($[0],$[1],$[2],$[3]),o.fillStyle=`hsla(${_}, 100%, 70%, ${n})`,o.strokeStyle=`hsla(${_}, 100%, 40%, 1.0)`,o.lineWidth=1,o.fill(),o.stroke(),o.closePath()}d.imageSmoothingEnabled=!1,i.imageSmoothingEnabled=!1,c.addEventListener("dragover",E),c.addEventListener("dragleave",E),c.addEventListener("drop",function e(t){t.preventDefault(),c.classList.remove("drag-over");let _=t.dataTransfer.files[0];y(_)}),u.addEventListener("change",function e(t){let _=t.target.files[0];y(_)}),f.addEventListener("click",p),d.addEventListener("mousemove",function e(t){let n=d.getBoundingClientRect();_[0]=t.clientX-n.left,_[1]=t.clientY-n.top}),d.addEventListener("click",function e(t){let n=$.findIndex(e=>{let t=L(e[0],e[1]),n=L(_[0],_[1]);return t.toString()===n.toString()});n>-1?$.splice(n,1):$.push([..._]);let[l,s]=$.reduce((e,t)=>{let _=L(t[0],t[1]),n=S(_[0],_[1]);return n[0]+=12*r,n[1]+=4*r,n[0]>e[0]&&(e[0]=n[0]),n[1]>e[1]&&(e[1]=n[1]),e},[0,0]);v(l,s)}),h.addEventListener("change",function e(t){l=(r=Number(t.target.value))/2}),m.addEventListener("click",function t(){var _=e.createElement("a");_.download=s,_.href=i.toDataURL(),_.click()}),v(0,0),p();let x=[{src:[2,0],dest:[[4,2],[6,2],[4,4],[6,4],[8,6],[10,2],[10,6],[14,0],[14,2],[14,6],[16,4],[18,0],[18,2],]},{src:[3,0],dest:[[3,2],[5,2],[3,4],[5,4],[9,0],[9,2],[9,6],[13,2],[13,6],[15,6],[19,0],[21,4],[23,2],]},{src:[2,1],dest:[[4,1],[4,3],[6,1],[6,3],[8,1],[10,1],[10,5],[14,1],[14,5],[14,7],[16,5],[20,5],[20,7],]},{src:[3,1],dest:[[3,1],[3,3],[5,1],[5,3],[9,1],[9,5],[9,7],[13,1],[13,5],[15,1],[19,3],[21,7],[23,3],]},{src:[0,2],dest:[[0,0],[2,0],[0,6],[2,6],[16,0]]},{src:[1,2],dest:[[3,0],[3,6],[5,0],[5,6],[11,0],[13,0],[17,0],[21,0],]},{src:[2,2],dest:[[4,0],[4,6],[6,0],[6,6],[10,0],[12,0],[20,0],[22,0],]},{src:[3,2],dest:[[1,0],[1,6],[7,0],[7,6],[23,0],]},{src:[0,3],dest:[[0,1],[0,3],[2,1],[2,3],[8,3],[8,5],[16,1],[16,3],]},{src:[1,3],dest:[[9,3],[11,1],[11,3],[11,5],[13,3],[15,7],[17,1],[17,3],[17,5],[19,1],[19,5],[21,1],[21,5],]},{src:[2,3],dest:[[8,7],[10,3],[12,1],[12,3],[12,5],[14,3],[18,1],[18,3],[18,5],[20,1],[22,1],[22,3],[22,5],]},{src:[3,3],dest:[[1,1],[1,3],[7,1],[7,3],[15,3],[15,5],[23,1],[23,5],]},{src:[0,4],dest:[[0,2],[0,4],[2,2],[2,4],[8,2],[8,4],[16,2],[16,6],]},{src:[1,4],dest:[[9,4],[11,2],[11,4],[11,6],[13,4],[15,0],[17,2],[17,4],[17,6],[19,2],[19,4],[19,6],[21,6],]},{src:[2,4],dest:[[8,0],[10,4],[12,2],[12,4],[12,6],[14,4],[18,4],[18,6],[20,4],[20,6],[22,2],[22,4],[22,6],]},{src:[3,4],dest:[[1,2],[1,4],[7,2],[7,4],[15,2],[15,4],[23,4],[23,6],]},{src:[0,5],dest:[[0,5],[0,7],[2,5],[2,7],[16,7],]},{src:[1,5],dest:[[3,5],[3,7],[5,5],[5,7],[11,7],[13,7],[17,7],[19,7],]},{src:[2,5],dest:[[4,5],[4,7],[6,5],[6,7],[10,7],[12,7],[18,7],[22,7],]},{src:[3,5],dest:[[1,5],[1,7],[7,5],[7,7],[23,7],]}];function S(e,t){let _=e/(2*r),n=t/(3*r);return[12*_*r,4*n*r,]}function k(e){let[t,_]=L(e[0],e[1]),[$,r]=S(t,_);for(let s of x){srcPos=s.src;let d=t+srcPos[0]*l,i=_+srcPos[1]*l,o=l,c=l;for(let u of s.dest){let g=$+u[0]*l,f=r+u[1]*l;a.drawImage(n,d,i,o,c,g,f,o,c)}}}function b(){for(let e of(o.clearRect(0,0,d.width,d.height),n&&o.drawImage(n,0,0),$))B(e[0],e[1],210,.5);for(let t of(B(_[0],_[1],0,.2),a.clearRect(0,0,i.width,i.height),$))k(t);requestAnimationFrame(b)}let R,C=(t=b,function(){let e=this,_=arguments,n=function(){R=null,t.apply(e,_)};clearTimeout(R),R=setTimeout(n,500)});C()}(document);
    </script>
  </body>
</html>
